<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë‰´ìŠ¤ ì±—ë´‡</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0f0f12;
      --surface: #1a1a20;
      --border: #2a2a32;
      --text: #e8e8ed;
      --text-muted: #8888a0;
      --accent: #6366f1;
      --accent-hover: #818cf8;
      --user-msg: #2d2d3a;
      --bot-msg: #252530;
      --success: #22c55e;
      --error: #ef4444;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      line-height: 1.6;
    }
    .container {
      max-width: 720px;
      margin: 0 auto;
      padding: 24px 16px;
    }
    header {
      text-align: center;
      margin-bottom: 32px;
    }
    header h1 {
      font-size: 1.75rem;
      font-weight: 700;
      margin-bottom: 6px;
    }
    header p {
      color: var(--text-muted);
      font-size: 0.9rem;
    }
    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .card h2 {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 14px;
      color: var(--text-muted);
    }
    .input-row {
      display: flex;
      gap: 10px;
      margin-bottom: 12px;
    }
    .input-row input {
      flex: 1;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 12px 14px;
      color: var(--text);
      font-size: 1rem;
      font-family: inherit;
    }
    .input-row input::placeholder { color: var(--text-muted); }
    .input-row input:focus {
      outline: none;
      border-color: var(--accent);
    }
    .btn {
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 12px 20px;
      font-size: 0.95rem;
      font-weight: 500;
      cursor: pointer;
      font-family: inherit;
    }
    .btn:hover { background: var(--accent-hover); }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .btn-secondary {
      background: var(--border);
      color: var(--text);
    }
    .btn-secondary:hover { background: #3a3a45; }
    .news-list {
      list-style: none;
    }
    .news-list li {
      border-bottom: 1px solid var(--border);
      padding: 12px 0;
    }
    .news-list li:last-child { border-bottom: none; }
    .news-list .title {
      font-weight: 500;
      margin-bottom: 4px;
    }
    .news-list .meta {
      font-size: 0.8rem;
      color: var(--text-muted);
    }
    .news-list a {
      color: var(--accent);
      text-decoration: none;
      font-size: 0.85rem;
    }
    .news-list a:hover { text-decoration: underline; }
    .summary-box {
      background: var(--bg);
      border-radius: 8px;
      padding: 16px;
      white-space: pre-wrap;
      margin-bottom: 16px;
    }
    .chat-area {
      display: flex;
      flex-direction: column;
      min-height: 320px;
    }
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 12px 0;
      max-height: 400px;
    }
    .msg {
      max-width: 85%;
      padding: 12px 14px;
      border-radius: 12px;
      margin-bottom: 10px;
      font-size: 0.95rem;
    }
    .msg.user {
      background: var(--user-msg);
      margin-left: auto;
      border-bottom-right-radius: 4px;
    }
    .msg.bot {
      background: var(--bot-msg);
      border: 1px solid var(--border);
      border-bottom-left-radius: 4px;
    }
    .chat-form {
      display: flex;
      gap: 10px;
      margin-top: 12px;
    }
    .chat-form input {
      flex: 1;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 12px 14px;
      color: var(--text);
      font-size: 1rem;
      font-family: inherit;
    }
    .chat-form input:focus {
      outline: none;
      border-color: var(--accent);
    }
    .status {
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-top: 8px;
    }
    .status.error { color: var(--error); }
    .status.success { color: var(--success); }
    .hidden { display: none !important; }
    .spinner::after {
      content: '';
      display: inline-block;
      width: 14px;
      height: 14px;
      margin-left: 8px;
      border: 2px solid transparent;
      border-top-color: currentColor;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ğŸ“° ë‰´ìŠ¤ ì±—ë´‡</h1>
      <p>í‚¤ì›Œë“œë¡œ ë‰´ìŠ¤ 10ê±´ì„ ìˆ˜ì§‘í•˜ê³ , ìš”ì•½Â·ì§ˆë¬¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
    </header>

    <div class="card">
      <h2>1. í‚¤ì›Œë“œë¡œ ë‰´ìŠ¤ ìˆ˜ì§‘</h2>
      <div class="input-row">
        <input type="text" id="keyword" placeholder="ì˜ˆ: ì¸ê³µì§€ëŠ¥, ì‚¼ì„±ì „ì" />
        <button type="button" class="btn" id="btnFetch">ë‰´ìŠ¤ ìˆ˜ì§‘ (10ê±´)</button>
      </div>
      <p id="fetchStatus" class="status hidden"></p>
    </div>

    <div class="card hidden" id="newsCard">
      <h2>ìˆ˜ì§‘ëœ ë‰´ìŠ¤</h2>
      <ul class="news-list" id="newsList"></ul>
      <button type="button" class="btn btn-secondary" id="btnSummarize">ìš”ì•½í•˜ê¸°</button>
      <p id="summarizeStatus" class="status hidden"></p>
    </div>

    <div class="card hidden" id="summaryCard">
      <h2>ë‰´ìŠ¤ ìš”ì•½</h2>
      <div class="summary-box" id="summaryText"></div>
    </div>

    <div class="card hidden" id="chatCard">
      <h2>ë‰´ìŠ¤ì— ëŒ€í•´ ì§ˆë¬¸í•˜ê¸°</h2>
      <div class="chat-area">
        <div class="chat-messages" id="chatMessages"></div>
        <form class="chat-form" id="chatForm">
          <input type="text" id="chatInput" placeholder="ìš”ì•½ëœ ë‰´ìŠ¤ì— ëŒ€í•´ ê¶ê¸ˆí•œ ê²ƒì„ ë¬¼ì–´ë³´ì„¸ìš”." autocomplete="off" />
          <button type="submit" class="btn" id="btnSend">ì „ì†¡</button>
        </form>
      </div>
      <p id="chatStatus" class="status hidden"></p>
    </div>
  </div>

  <script>
    const keywordEl = document.getElementById('keyword');
    const btnFetch = document.getElementById('btnFetch');
    const fetchStatus = document.getElementById('fetchStatus');
    const newsCard = document.getElementById('newsCard');
    const newsList = document.getElementById('newsList');
    const btnSummarize = document.getElementById('btnSummarize');
    const summarizeStatus = document.getElementById('summarizeStatus');
    const summaryCard = document.getElementById('summaryCard');
    const summaryText = document.getElementById('summaryText');
    const chatCard = document.getElementById('chatCard');
    const chatMessages = document.getElementById('chatMessages');
    const chatForm = document.getElementById('chatForm');
    const chatInput = document.getElementById('chatInput');
    const btnSend = document.getElementById('btnSend');
    const chatStatus = document.getElementById('chatStatus');

    let chatHistory = [];

    function showStatus(el, msg, type) {
      el.textContent = msg;
      el.className = 'status ' + (type || '');
      el.classList.remove('hidden');
    }
    function hideStatus(el) { el.classList.add('hidden'); }

    async function fetchNews() {
      const keyword = keywordEl.value.trim();
      if (!keyword) {
        showStatus(fetchStatus, 'í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.', 'error');
        return;
      }
      btnFetch.disabled = true;
      showStatus(fetchStatus, 'ìˆ˜ì§‘ ì¤‘...', 'spinner');
      try {
        const res = await fetch('/api/news', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ keyword }),
          credentials: 'same-origin'
        });
        const data = await res.json();
        if (!data.ok) {
          showStatus(fetchStatus, data.error || 'ìˆ˜ì§‘ ì‹¤íŒ¨', 'error');
          return;
        }
        hideStatus(fetchStatus);
        newsList.innerHTML = (data.articles || []).map(a =>
          `<li>
            <div class="title">${escapeHtml(a.title || '')}</div>
            ${a.summary ? `<div class="meta">${escapeHtml(a.summary.slice(0, 120))}â€¦</div>` : ''}
            <a href="${escapeHtml(a.link || '#')}" target="_blank" rel="noopener">ê¸°ì‚¬ ë³´ê¸°</a>
          </li>`
        ).join('');
        newsCard.classList.remove('hidden');
        summaryCard.classList.add('hidden');
        summaryText.textContent = '';
        chatCard.classList.add('hidden');
        chatHistory = [];
      } catch (e) {
        showStatus(fetchStatus, 'ì—°ê²° ì˜¤ë¥˜: ' + e.message, 'error');
      } finally {
        btnFetch.disabled = false;
      }
    }

    async function doSummarize() {
      btnSummarize.disabled = true;
      showStatus(summarizeStatus, 'ìš”ì•½ ì¤‘...', 'spinner');
      try {
        const res = await fetch('/api/summarize', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: '{}',
          credentials: 'same-origin'
        });
        const data = await res.json();
        if (!data.ok) {
          showStatus(summarizeStatus, data.error || 'ìš”ì•½ ì‹¤íŒ¨', 'error');
          return;
        }
        hideStatus(summarizeStatus);
        summaryText.textContent = data.summary || '';
        summaryCard.classList.remove('hidden');
        chatCard.classList.remove('hidden');
        chatMessages.innerHTML = '';
        chatHistory = [];
      } catch (e) {
        showStatus(summarizeStatus, 'ì—°ê²° ì˜¤ë¥˜: ' + e.message, 'error');
      } finally {
        btnSummarize.disabled = false;
      }
    }

    function escapeHtml(s) {
      const div = document.createElement('div');
      div.textContent = s;
      return div.innerHTML;
    }

    function addMessage(role, text) {
      const div = document.createElement('div');
      div.className = 'msg ' + role;
      div.textContent = text;
      chatMessages.appendChild(div);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    async function sendChat() {
      const message = chatInput.value.trim();
      if (!message) return;
      chatInput.value = '';
      addMessage('user', message);
      chatHistory.push({ role: 'user', text: message });

      btnSend.disabled = true;
      const placeholder = document.createElement('div');
      placeholder.className = 'msg bot';
      placeholder.textContent = 'ë‹µë³€ ìƒì„± ì¤‘â€¦';
      placeholder.classList.add('spinner');
      chatMessages.appendChild(placeholder);
      chatMessages.scrollTop = chatMessages.scrollHeight;

      try {
        const res = await fetch('/api/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message, history: chatHistory.slice(0, -1) }),
          credentials: 'same-origin'
        });
        const data = await res.json();
        placeholder.remove();
        if (!data.ok) {
          addMessage('bot', 'ì˜¤ë¥˜: ' + (data.error || 'ì•Œ ìˆ˜ ì—†ìŒ'));
          return;
        }
        chatHistory.push({ role: 'model', text: data.reply });
        addMessage('bot', data.reply);
      } catch (e) {
        placeholder.remove();
        addMessage('bot', 'ì—°ê²° ì˜¤ë¥˜: ' + e.message);
      } finally {
        btnSend.disabled = false;
      }
    }

    btnFetch.addEventListener('click', fetchNews);
    btnSummarize.addEventListener('click', doSummarize);
    chatForm.addEventListener('submit', (e) => { e.preventDefault(); sendChat(); });
  </script>
</body>
</html>
